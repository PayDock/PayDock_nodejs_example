<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        iframe {
            border: 0;
            width: 100%;
			height: 300px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.2.1.js"></script>
    <script src="https://app-sandbox.paydock.com/v1/widget.umd.js" ></script>
	<script src="widget.js" ></script>
</head>
<body>
	<div id="vaultbuttons"></div>

	<form id="paymentForm">
		$ <input type="text" id="amount" value="50"><br>

		<select id="currency">
			<option value="AUD">Australian Dollars</option>
			<option value="USD">American Dollars</option>
			<option value="GBP">British Pounds</option>
		</select>


		<input type="hidden" name="token" id="token" AUTOCOMPLETE="off"/>
		<input type="hidden" name="vault_id" id="vault_id" AUTOCOMPLETE="off"/>
		<input type="hidden" name="customer_id" id="customer_id" AUTOCOMPLETE="off"/>
		<input type="submit" value="Submit">

	</form> 

	<div id="widget1"></div>
	<div id="widget2"></div>
	<div id="widget3"></div>
	
	<!-- <button onclick="customervault();">Use Saved payment details</button> -->
	<!-- <button onclick="myFunction('597a88f0fd3abd105fd97d4a')">Mastercard</button> -->
	<script>
		var test_customer_id = '597a88cf37cce574c8d060d1';
		// 59756297fd3abd105fd92938 single saved payment source
		// 597a88cf37cce574c8d060d1 four saved payment sources

		$('#customer_id').val(test_customer_id);
		var jsonData = {
            'customer_id' :  test_customer_id
        };

		jQuery.ajax({
            method: "POST",
            url: "/vault", 
            contentType: "application/json",
            data: JSON.stringify(jsonData),
            success: function (data) {
				var parsedData = JSON.parse(data);
				//console.log(parsedData);
				//console.log(parsedData.length);
				//console.log(data);
				for (var counter in parsedData) {
					createvaultbutton(parsedData[counter]._id, parsedData[counter].cardType, parsedData[counter].isBank);
				}
			}
        });

		$(document).submit(function(event){
			postData();
	        event.preventDefault();
		});

		function postData(){

            var jsonData = {
            	'amount' : $('#amount').val(),
	            'currency' :  $('#currency').val(),
	            'token' :  $('#token').val(),
	            'vault_id' :  $('#vault_id').val(),
	            'customer_id' : $('#customer_id').val()
	        };

	        $.ajax({
	            method: "POST",
	            url: "/payment", 
	            contentType: "application/json",
	            dataType: "json",
	            data: JSON.stringify(jsonData)
	        });

		}

		function createvaultbutton(payment_id, cardType, isBank) {
			var btn = document.createElement("BUTTON");
			document.body.appendChild(btn);
			btn.setAttribute( "onclick", "javascript: selectFromVault('" + payment_id + "');" );
			if (isBank == "card") {
				btn.innerHTML = cardType;
			} else {
				btn.innerHTML = "Bank";
			}
		}

		function selectFromVault(paymentid) {
			$('#vault_id').val(paymentid);
			$('#token').val('');
		}

	</script>
</body>
</html>